#!/bin/bash

report_listening_services() {
    local listening_services

    # Run ss -plnt and extract relevant columns
    listening_services=$(ss -plnt | awk 'NR>1 {print $4, $6}' | sed 's/users:(("//;s/",.*//')

    if [[ -n "$listening_services" ]]; then
        write_audit_report "Malware" "Listening Services: $listening_services"
    fi
    # No action is taken if there are no listening services
}

check_rkhunter() {
    if ! command -v rkhunter &> /dev/null; then
        write_audit_report "Malware" "rkhunter is not installed"
    else
        local rkhunter_warnings

        # Extract warnings from rkhunter log
        rkhunter_warnings=$(sudo cat /var/log/rkhunter.log | grep Warning)

        if [[ -n "$rkhunter_warnings" ]]; then
            write_audit_report "Malware" "rkhunter Warnings: $rkhunter_warnings"
        fi
    fi
    # No action is taken if rkhunter is installed but no warnings are found
}
